@using System.Timers
@inject NavigationManager NavManager
@page "/404"

<div class="flex flex-col items-center justify-center min-h-[70vh] text-center p-6 bg-gray-50">
    
    <!-- Title and Interactive Element -->
    <h1 class="text-9xl font-extrabold text-indigo-700 tracking-widest animate-bounce">
        404
    </h1>
    
    <div class="bg-red-500 text-white px-4 py-2 text-sm rounded-lg rotate-3 shadow-xl mb-8">
        PAGE NOT FOUND
    </div>

    <p class="text-xl text-gray-700 mb-6">
        Oops! We couldn't find the requested page.
        Maybe a quantum fluctuation shifted the bits?
    </p>

    <!-- Interactive Countdown Timer -->
    <div class="p-4 rounded-xl bg-gray-100 shadow-inner w-full max-w-sm mb-8">
        <p class="text-md text-gray-600 font-medium">
            Redirecting in <span class="text-indigo-600 text-2xl font-bold">@countdownSeconds</span> seconds...
        </p>
    </div>

    <!-- Cool Button -->
    <button @onclick="GoHome"
            class="px-8 py-3 text-lg font-semibold text-white bg-green-500 rounded-full shadow-lg 
                   hover:bg-green-600 transform hover:scale-105 transition duration-300 ease-in-out">
        Go Home Now (Don't Wait)
    </button>
</div>

@code {
    private Timer timer = null!;
    private int countdownSeconds = 10;
    
    // Lifecycle method runs when the component is initialized
    protected override void OnInitialized()
    {
        // Set up the timer to tick every 1000ms (1 second)
        timer = new Timer(1000);
        timer.Elapsed += OnTimerElapsed;
        timer.AutoReset = true;
        timer.Enabled = true;
    }
    
    // Method executed on the server every time the timer ticks
    private void OnTimerElapsed(object? sender, ElapsedEventArgs e)
    {
        // Must use InvokeAsync to safely update the UI from a non-UI thread (the Timer thread)
        InvokeAsync(() =>
        {
            countdownSeconds--;
            
            if (countdownSeconds <= 0)
            {
                // Stop the timer and redirect
                timer.Stop();
                NavManager.NavigateTo("/");
            }
            StateHasChanged(); // Tell Blazor to re-render (update the countdown number)
        });
    }

    // Interactive button click handler
    private void GoHome()
    {
        timer.Stop(); // Stop the countdown if the user clicks the button
        NavManager.NavigateTo("/");
    }
    
    // Lifecycle method runs when the component is removed
    public void Dispose()
    {
        // Always dispose of timers and resources to prevent memory leaks/server errors
        if (timer != null)
        {
            timer.Dispose();
        }
    }
}